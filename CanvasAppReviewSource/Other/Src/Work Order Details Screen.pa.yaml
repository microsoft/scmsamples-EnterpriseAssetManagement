# ************************************************************************************************
# Warning: YAML source code for Canvas Apps is in preview. The schema is being actively developed.
# Content may be incomplete and subject to change.
# This file is read-only and should only be used to review changes made within Power Apps Studio.
# This file isn't used when loading the app. External editing, merging and conflict resolution are
# not supported.
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  Work Order Details Screen:
    Properties:
      Fill: =gblAppColors.Background
      OnVisible: |+
        =Set(
            gblWorkOrderLifecycleState,
            WorkOrder.'Lifecycle state'
        );
        Set(
            gblWorkOrderLifecycleModel,
            WorkOrder.'Asset management work order types'.'Lifecycle model'
        );
        UpdateContext(
            {
                varPage: If(
                    ShowInformation,
                    C.WorkOrderDetailsScreen.DetailsSubPage,
                    gblPreviousScreen = 'Work Order Job Details Screen',
                    C.WorkOrderDetailsScreen.JobsSubPage,
                    C.WorkOrderDetailsScreen.DetailsSubPage
                ),
                varShowStateChangePrompt: false,
                ShowInformation: false
            }
        );
        // should go last
        Set(
            gblPreviousScreen,
            Self
        );
    Children:
      - galWorkOrderLines:
          Control: Gallery@2.15.0
          Variant: VariableHeight
          Properties:
            DelayItemLoading: =false
            Height: =Parent.Height - Self.Y
            Items: |-
              =SortByColumns(
                  Filter(
                      'Asset management work order jobs V2 (mserp)',
                      'Company Code' = WorkOrder.'Company Code',
                      'Work order' = WorkOrder.'Work order'
                  ),
                  "mserp_linenumber"
              )
            LoadingSpinner: =LoadingSpinner.Controls
            OnSelect: |-
              =Navigate(
                  'Work Order Job Details Screen',
                  Transition.None,
                  {
                      Job: LookUp('Asset management work order jobs V2 (mserp)',
                          'Company Code' = ThisItem.'Company Code'
                          And 'Work order' = ThisItem.'Work order'
                          And 'Line number' = ThisItem.'Line number'
                      )
                  }
              )
            ShowScrollbar: =false
            TemplateSize: =250
            Visible: |-
              =varPage = C.WorkOrderDetailsScreen.JobsSubPage And With(
                  {locJob: First(Self.AllItems)},
                  locJob.mserp_dataareaid = WorkOrder.mserp_dataareaid
                  And locJob.mserp_workorderid = WorkOrder.mserp_workorderid
              )
            Width: =Parent.Width
            Y: =conWorkOrderNavigation.Y + conWorkOrderNavigation.Height
          Children:
            - htmLineCardBackgroundWODS:
                Control: HtmlViewer@2.1.0
                Properties:
                  DisabledBorderColor: =RGBA(56, 56, 56, 1)
                  Height: =conWorkOrderLineDetails.Height
                  HtmlText: |-
                    ="<div style=""padding: 5px 8px 10px;height:100%;position:absolute;width:100%;box-sizing:border-box;""><div style=""background-color:#fff;box-shadow:0px 2px 4px rgba(0,0,0,0.14),0px 0px 2px rgba(0,0,0, 0.12);border-radius:15px;height:100%;width:100%;""></div></div>"
                  OnSelect: =Select(Parent)
                  PaddingBottom: =0
                  PaddingLeft: =0
                  PaddingRight: =0
                  Width: =Parent.TemplateWidth
            - conWorkOrderLineDetails:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  Height: |-
                    =lblWorkOrderLineAsset.Height
                        + lblWorkOrderLineDescription.Height
                        + conWorkOrderLineFunctionalLocation.Height
                        + conWorkOrderLineJobType.Height
                        + If(conWorkOrderLineTrade.Visible, conWorkOrderLineTrade.Height)
                        + If(conWorkOrderLineJobTypeVariant.Visible, conWorkOrderLineJobTypeVariant.Height)
                        + Self.LayoutGap * (4 + conWorkOrderLineTrade.Visible + conWorkOrderLineJobTypeVariant.Visible)
                        + Self.PaddingBottom
                        + Self.PaddingTop
                  LayoutAlignItems: =LayoutAlignItems.Stretch
                  LayoutDirection: =LayoutDirection.Vertical
                  LayoutGap: =4
                  PaddingBottom: =20
                  PaddingLeft: =20
                  PaddingRight: =20
                  PaddingTop: =24
                  Width: =Parent.TemplateWidth
                Children:
                  - lblWorkOrderLineAsset:
                      Control: Label@2.5.1
                      Properties:
                        AlignInContainer: =AlignInContainer.Start
                        AutoHeight: =true
                        Color: =RGBA(41, 40, 39, 1)
                        Font: =gblAppStyles.HeadLine.Font
                        FontWeight: =FontWeight.Semibold
                        Height: =
                        LayoutMinHeight: =26
                        LayoutMinWidth: =280
                        Overflow: =Overflow.Scroll
                        PaddingBottom: =0
                        PaddingLeft: =0
                        PaddingRight: =0
                        PaddingTop: =0
                        Size: =14.5
                        Text: |-
                          =//pal-disable PAL004
                          $"({ThisItem.'Assets entity view V3 (mserp_FK_MaintenanceAsset_id)'.'Asset (mserp_maintenanceassetid)'}) {ThisItem.'Assets entity view V3 (mserp_FK_MaintenanceAsset_id)'.Name}"
                        Width: =Parent.Width - lblWorkOrderLineNumber.Width - 8 - Parent.PaddingLeft - Parent.PaddingRight
                        X: =
                        Y: =
                  - lblWorkOrderLineDescription:
                      Control: Label@2.5.1
                      Properties:
                        AlignInContainer: =AlignInContainer.Stretch
                        Color: =RGBA(41, 40, 39, 1)
                        Font: =gblAppStyles.HeadLine.Font
                        Height: =
                        LayoutMinHeight: =12
                        LayoutMinWidth: =Parent.Width - Self.X - Parent.PaddingLeft - Parent.PaddingRight
                        Overflow: =Overflow.Scroll
                        PaddingBottom: =0
                        PaddingLeft: =0
                        PaddingRight: =0
                        PaddingTop: =0
                        Size: =11
                        Text: =ThisItem.mserp_workorderjobdescription
                        Width: =lblWorkOrderLineNumber.Width
                        Wrap: =false
                        X: =
                        Y: =
                  - conWorkOrderLineFunctionalLocation:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =32
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutDirection: =LayoutDirection.Horizontal
                        LayoutGap: =10
                      Children:
                        - icoWorkOrderLineFunctionalLocation:
                            Control: Classic/Icon@2.5.0
                            Properties:
                              Color: =RGBA(162, 126, 111, 1)
                              FocusedBorderThickness: =0
                              Height: =13
                              Icon: =Icon.Location
                              Width: =13
                              X: =8
                              Y: =Parent.Height / 2 - Self.Height / 2
                        - lblWorkOrderLineFunctionalLocation:
                            Control: Label@2.5.1
                            Properties:
                              Color: =RGBA(41, 40, 39, 1)
                              Font: =Font.'Segoe UI'
                              FontWeight: =FontWeight.Semibold
                              Height: =28
                              PaddingBottom: =0
                              PaddingLeft: =0
                              PaddingRight: =0
                              PaddingTop: =0
                              Size: =10.5
                              Text: |-
                                =//pal-disable PAL004
                                $"({ThisItem.'Functional location'}) {ThisItem.'Asset management functional locations'.Name}"
                              Width: =Parent.Width - Self.X
                              X: =icoWorkOrderLineFunctionalLocation.X + icoWorkOrderLineFunctionalLocation.Width + 5
                              Y: =Parent.Height / 2 - Self.Height / 2
                  - conWorkOrderLineJobType:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =32
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutDirection: =LayoutDirection.Horizontal
                        LayoutGap: =10
                      Children:
                        - icoWorkOrderLineJobType:
                            Control: Classic/Icon@2.5.0
                            Properties:
                              Color: =RGBA(162, 126, 111, 1)
                              FocusedBorderThickness: =0
                              Height: =13
                              Icon: =Icon.ToolsWrench
                              Width: =13
                              X: =8
                              Y: =Parent.Height / 2 - Self.Height / 2
                        - lblWorkOrderLineJobType:
                            Control: Label@2.5.1
                            Properties:
                              Color: =RGBA(41, 40, 39, 1)
                              Font: =Font.'Segoe UI'
                              FontWeight: =FontWeight.Semibold
                              Height: =28
                              PaddingBottom: =0
                              PaddingLeft: =0
                              PaddingRight: =0
                              PaddingTop: =0
                              Size: =10.5
                              Text: =ThisItem.mserp_jobtypeid
                              Width: =Parent.Width - Self.X
                              X: =icoWorkOrderLineJobType.X + icoWorkOrderLineJobType.Width + 5
                              Y: =Parent.Height / 2 - Self.Height / 2
                  - conWorkOrderLineJobTypeVariant:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =32
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutDirection: =LayoutDirection.Horizontal
                        LayoutGap: =10
                        Visible: =Not(IsBlank(ThisItem.mserp_jobvariantid))
                      Children:
                        - icoWorkOrderLineJobTypeVariant:
                            Control: Classic/Icon@2.5.0
                            Properties:
                              Color: =RGBA(135, 100, 184, 1)
                              FocusedBorderThickness: =0
                              Height: =13
                              Icon: =Icon.OptionsList
                              Width: =13
                              X: =8
                              Y: =Parent.Height / 2 - Self.Height / 2
                        - lblWorkOrderLineJobTypeVariant:
                            Control: Label@2.5.1
                            Properties:
                              Color: =RGBA(41, 40, 39, 1)
                              Font: =Font.'Segoe UI'
                              FontWeight: =FontWeight.Semibold
                              Height: =28
                              PaddingBottom: =0
                              PaddingLeft: =0
                              PaddingRight: =0
                              PaddingTop: =0
                              Size: =10.5
                              Text: =ThisItem.mserp_jobvariantid
                              Width: =Parent.Width - Self.X
                              X: =icoWorkOrderLineJobTypeVariant.X + icoWorkOrderLineJobTypeVariant.Width + 5
                              Y: =Parent.Height / 2 - Self.Height / 2
                  - conWorkOrderLineTrade:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =32
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutDirection: =LayoutDirection.Horizontal
                        LayoutGap: =10
                        Visible: =Not(IsBlank(ThisItem.mserp_jobtradeid))
                      Children:
                        - icoWorkOrderLineTrade:
                            Control: Classic/Icon@2.5.0
                            Properties:
                              Color: =RGBA(135, 100, 184, 1)
                              FocusedBorderThickness: =0
                              Height: =13
                              Icon: =Icon.Person
                              Width: =13
                              X: =8
                              Y: =Parent.Height / 2 - Self.Height / 2
                        - lblWorkOrderLineTradeWODS:
                            Control: Label@2.5.1
                            Properties:
                              Color: =RGBA(41, 40, 39, 1)
                              Font: =Font.'Segoe UI'
                              FontWeight: =FontWeight.Semibold
                              Height: =28
                              PaddingBottom: =0
                              PaddingLeft: =0
                              PaddingRight: =0
                              PaddingTop: =0
                              Size: =10.5
                              Text: =ThisItem.mserp_jobtradeid
                              Width: =Parent.Width - Self.X
                              X: =icoWorkOrderLineTrade.X + icoWorkOrderLineTrade.Width + 5
                              Y: =Parent.Height / 2 - Self.Height / 2
            - lblWorkOrderLineNumber:
                Control: Label@2.5.1
                Properties:
                  Align: =Align.Right
                  AutoHeight: =true
                  BorderColor: =RGBA(0, 0, 0, 1)
                  Color: =RGBA(57, 57, 57, 1)
                  Font: =Font.'Segoe UI'
                  Height: =20
                  PaddingBottom: =0
                  PaddingLeft: =0
                  PaddingRight: =0
                  PaddingTop: =0
                  Size: =9
                  Text: |-
                    =//pal-disable PAL004
                    $"[{ThisItem.mserp_linenumber}]"
                  Tooltip: =T.LineNumberAccessibleLabel
                  VerticalAlign: =VerticalAlign.Top
                  Width: =30
                  X: =Parent.Width - Self.Width - conWorkOrderLineDetails.PaddingRight - 15
                  Y: =30
            - shpLineClickSurfaceWODS:
                Control: Rectangle@2.3.0
                Properties:
                  Fill: =RGBA(0, 0, 0, 0)
                  FocusedBorderColor: =gblAppStyles.FocusBorderColor
                  FocusedBorderThickness: =gblAppStyles.FocusBorderThickness
                  Height: =conWorkOrderLineDetails.Height
                  OnSelect: |-
                    =// Containers do not support OnSelect override
                    // and catches user clicks, we need this surface to negate that problem.
                    Select(Parent)
                  TabIndex: =0
                  Width: =Parent.TemplateWidth
      - conInformationWODS:
          Control: GroupContainer@1.3.0
          Variant: AutoLayout
          Properties:
            Height: =Parent.Height - Self.Y - btnChangeWorkOrderLifecycleState.Height - 16 * 2
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutDirection: =LayoutDirection.Vertical
            LayoutOverflowY: =LayoutOverflow.Scroll
            PaddingLeft: |-
              =// Yes, specifically 9- to simulate a padding of 16px when the card shadow is taken into account
              9
            PaddingRight: =9
            Visible: =varPage = C.WorkOrderDetailsScreen.DetailsSubPage
            Width: =Parent.Width
            X: =
            Y: =conWorkOrderNavigation.Y + conWorkOrderNavigation.Height
      - btnChangeWorkOrderLifecycleState:
          Control: Classic/Button@2.2.0
          Properties:
            BorderThickness: =0
            Fill: =RGBA(7, 66, 171, 1)
            FocusedBorderColor: =gblAppStyles.FocusBorderColor
            FocusedBorderThickness: =gblAppStyles.FocusBorderThickness
            Font: =gblAppStyles.Button.Font
            Height: =52
            OnSelect: |
              =UpdateContext(
                  {
                      varShowStateChangePrompt: true,
                      varIsLoadingAvailableWorkOrderStates: true,
                      varAvailableWorkOrderStates: Blank()
                  }
              );
              UpdateContext(
                  {
                      varAvailableWorkOrderStates: RenameColumns(
                          SortByColumns(
                              Filter(
                                  'Asset management work order lifecycle model sequence next (mserp)',
                                  'Company Code' = WorkOrder.'Company Code',
                                  'Lifecycle state (mserp_lifecyclestateid)' = Coalesce(
                                      gblWorkOrderLifecycleState,
                                      WorkOrder.'Lifecycle state'
                                  ),
                                  'Lifecycle model (mserp_lifecyclemodelid)' = gblWorkOrderLifecycleModel,
                                  'Lifecycle state (mserp_nextlifecyclestateid)' <> Blank()
                              ),
                              "mserp_nextlifecyclestatelinenumber"
                          ),
                          'Lifecycle state (mserp_nextlifecyclestateid)',
                          label
                      )
                  }
              );
              UpdateContext({varIsLoadingAvailableWorkOrderStates: false});
            RadiusBottomLeft: =12
            RadiusBottomRight: =12
            RadiusTopLeft: =12
            RadiusTopRight: =12
            Size: =15 * 0.75
            Text: =T.WorkOrderStateChangeLabel
            Visible: =conInformationWODS.Visible
            Width: =Parent.Width - (16 * 2)
            X: =16
            Y: =Parent.Height - Self.Height - 16
