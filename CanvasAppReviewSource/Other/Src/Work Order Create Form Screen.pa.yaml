# ************************************************************************************************
# Warning: YAML source code for Canvas Apps is in preview. The schema is being actively developed.
# Content may be incomplete and subject to change.
# This file is read-only and should only be used to review changes made within Power Apps Studio.
# This file isn't used when loading the app. External editing, merging and conflict resolution are
# not supported.
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  Work Order Create Form Screen:
    Properties:
      Fill: =gblAppColors.Background
      OnVisible: "=Clear(locWOAttachments);\nIfError(\n    //try\n    UpdateContext(\n        {\n            locWOCount: CountRows(\n                GroupBy(\n                    Filter(\n                        'Asset management work order jobs V2 (mserp)',\n                        'Company Code' = locAsset.'Company Code',\n                        Asset = locAsset.'Asset (mserp_maintenanceassetid)',\n                        'Asset management work orders V2'.Active = 'NoYes (mserp)'.Yes\n                    ),\n                    'Work order',\n                    WorkOrders\n                )\n            )\n        }\n    ),\n    //catch\n    UpdateContext({locWOCount: Blank()});\n    Notify(\n        Match(\n            FirstError.Details.HttpResponse,\n            \"\\\"\"code\"\":\"\"(?<code>[^\"\"]*)\"\",\"\"message\"\":\"\"(?<message>[^\"\"]*)\"\n        ).message,\n        NotificationType.Error\n    );\n    \n);\nIfError(\n    UpdateContext(\n        {\n            locMRCount: With(\n                {\n                    locMaintenanceRequestsToCount: Filter(\n                        'Maintenance Requests',\n                        Asset = locAsset.'Asset (mserp_maintenanceassetid)',\n                        'Company Code' = locAsset.'Company Code',\n                        Active = 'NoYes (mserp)'.Yes\n                    )\n                },\n                CountRows(locMaintenanceRequestsToCount)\n            )\n        }\n    ),\n    //catch\n    UpdateContext({locMRCount: Blank()});\n    Notify(\n        Match(\n            FirstError.Details.HttpResponse,\n            \"\\\"\"code\"\":\"\"(?<code>[^\"\"]*)\"\",\"\"message\"\":\"\"(?<message>[^\"\"]*)\"\n        ).message,\n        NotificationType.Error\n    );\n    \n);\n\nSet(gblPreviousScreen, Self)\n"
    Children:
      - conVerticalCreateWorkOrder:
          Control: GroupContainer@1.3.0
          Variant: AutoLayout
          Properties:
            Height: =Parent.Height - btnCreateWOSubmit.Height -16
            LayoutDirection: =LayoutDirection.Vertical
            LayoutOverflowY: =LayoutOverflow.Scroll
            PaddingBottom: =10
            Width: =Parent.Width
          Children:
            - conCreateWOHeader:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  AlignInContainer: =AlignInContainer.SetByContainer
                  FillPortions: =0
                  Height: =52
                  Width: =Parent.Width
                Children:
                  - lblCreateWOHeader:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        Color: =RGBA(255, 255, 255, 1)
                        Fill: =gblAppStyles.Header.Fill
                        Font: =gblAppStyles.CommonFont
                        FontWeight: =gblAppStyles.Header.FontWeight
                        Height: =54
                        PaddingLeft: =icoCreateWOBackButton.Width
                        PaddingRight: =icoCreateWOBackButton.Width
                        Size: =gblAppStyles.Header.FontSize
                        Text: |-
                          =//pal-disable PAL004
                          locAsset.mserp_maintenanceassetid
                        Width: =Parent.Width
                        Wrap: =false
                        X: =
                  - icoCreateWOBackButton:
                      Control: Classic/Icon@2.5.0
                      Properties:
                        AccessibleLabel: =T.BackButtonAccessibleLabel
                        Color: =Color.White
                        FocusedBorderColor: =gblAppStyles.FocusBorderColor
                        FocusedBorderThickness: =gblAppStyles.FocusBorderThickness
                        Height: =Parent.Height
                        Icon: =Icon.ChevronLeft
                        OnSelect: |+
                          =Concurrent(
                              Reset(cmpNewWorkOrderDescription),
                              Reset(cmpNewWorkOrderNotes),
                              Reset(drpNewWorkOrderServiceLevel),
                              Reset(drpNewWorkOrderType)
                          );
                          Back();

                        PaddingBottom: =16
                        PaddingLeft: =16
                        PaddingRight: =16
                        PaddingTop: =16
                        TabIndex: =0
                        Width: =56
                        X: =2
                        Y: =2
            - conCreateWOSubHeader:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  AlignInContainer: =AlignInContainer.SetByContainer
                  Fill: =gblAppStyles.Header.Fill
                  FillPortions: =0
                  Height: =If(Self.Width <= conCreateWOSubHeader.LayoutMinWidth ,gblAppStyles.Pills.Height * 2 + 20 ,62)
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =If(Self.Width <= conCreateWOSubHeader.LayoutMinWidth ,LayoutDirection.Vertical,LayoutDirection.Horizontal)
                  LayoutGap: =10
                  LayoutMinWidth: =340
                  PaddingLeft: =16
                  PaddingRight: =16
                  Width: =Parent.Width
                Children:
                  - conExistingWorkOrdersWOCFS:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =42
                        LayoutMinWidth: =100
                        Width: =btnExistingWorkOrdersWOCFS.Width + 4
                      Children:
                        - btnExistingWorkOrdersWOCFS:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderThickness: =0
                              Color: =gblAppStyles.Pills.FontColor
                              DisabledColor: =gblAppStyles.Pills.DisabledColor
                              DisabledFill: =gblAppStyles.Pills.DisabledFill
                              DisplayMode: |-
                                =If(
                                    locWOCount > 0,
                                    DisplayMode.Edit,
                                    DisplayMode.Disabled
                                )
                              Fill: =gblAppStyles.Pills.Fill
                              FocusedBorderColor: =gblAppStyles.FocusBorderColor
                              FocusedBorderThickness: =gblAppStyles.FocusBorderThickness
                              Font: =gblAppStyles.Pills.Font
                              FontWeight: =gblAppStyles.Pills.FontWeight
                              Height: =gblAppStyles.Pills.Height
                              OnSelect: |-
                                =Navigate(
                                    'Maintenance Request Work Order List Screen',
                                    ScreenTransition.None,
                                    {locCreateMode: locCreateMode, locAsset: locAsset}
                                )
                              PaddingLeft: =Len(Self.Text)*1.2
                              PaddingRight: =0
                              PressedBorderColor: =
                              PressedColor: =gblAppStyles.Pills.PressedColor
                              PressedFill: =gblAppStyles.Pills.PressedFill
                              RadiusBottomLeft: =1000
                              RadiusBottomRight: =1000
                              RadiusTopLeft: =1000
                              RadiusTopRight: =1000
                              Size: =gblAppStyles.FontSize_Medium
                              Text: |-
                                =If(
                                    IsBlankOrError(locWOCount),
                                    T.MaintenanceWorkOrdersExistingLabel,
                                    Substitute(
                                        T.MaintenanceWorkOrdersExistingCountLabel,
                                        "{ExistingWorkOrdersCount}",
                                        If(
                                            locWOCount > 99,
                                            "99+",
                                            locWOCount
                                        )
                                    )
                                )
                              X: =1
                              Y: =2
                        - icoExistingWorkOrdersWOCFS:
                            Control: Classic/Icon@2.5.0
                            Properties:
                              Color: =gblAppColors.AccentInfo3
                              Fill: =RGBA(0,0,0,0)
                              Height: =17
                              Icon: =Icon.DetailList
                              OnSelect: =Select(btnExistingWorkOrdersWOCFS);
                              PaddingRight: =5
                              PressedFill: =gblAppStyles.Pills.PressedFill
                              Width: =29
                              X: =7
                              Y: =11
                  - conExistingMaintenanceRequestsWOCFS:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =42
                        LayoutMinWidth: =100
                        Width: =btnExistingMaintenanceRequestsWOCFS.Width + 4
                      Children:
                        - btnExistingMaintenanceRequestsWOCFS:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderThickness: =0
                              Color: =gblAppStyles.Pills.FontColor
                              DisabledColor: =gblAppStyles.Pills.DisabledColor
                              DisabledFill: =gblAppStyles.Pills.DisabledFill
                              DisplayMode: |-
                                =If(
                                    locMRCount > 0,
                                    DisplayMode.Edit,
                                    DisplayMode.Disabled
                                )
                              Fill: =gblAppStyles.Pills.Fill
                              FocusedBorderColor: =gblAppStyles.FocusBorderColor
                              FocusedBorderThickness: =gblAppStyles.FocusBorderThickness
                              Font: =gblAppStyles.Pills.Font
                              FontWeight: =gblAppStyles.Pills.FontWeight
                              Height: =gblAppStyles.Pills.Height
                              OnSelect: |-
                                =Navigate(
                                    'Maintenance Requests List Screen',
                                    ScreenTransition.None,
                                    {locCreateMode: locCreateMode, locAsset: locAsset}
                                )
                              PaddingLeft: =Len(Self.Text)*1.5
                              PaddingRight: =0
                              PressedBorderColor: =
                              PressedColor: =gblAppStyles.Pills.PressedColor
                              PressedFill: =gblAppStyles.Pills.PressedFill
                              RadiusBottomLeft: =1000
                              RadiusBottomRight: =1000
                              RadiusTopLeft: =1000
                              RadiusTopRight: =1000
                              Size: =gblAppStyles.Pills.FontSize
                              Text: |-
                                =If(
                                    IsBlankOrError(locMRCount),
                                    T.MaintenanceRequestsExistingLabel,
                                    Substitute(
                                        T.MaintenanceRequestsExistingCountLabel,
                                        "{ExistingRequestsCount}",
                                        If(
                                            locMRCount > 99,
                                            "99+",
                                            locMRCount
                                        )
                                    )
                                )
                              Width: =135
                              X: =2
                              Y: =2
                        - icoExistingMaintenanceRequestsWOCFS:
                            Control: Classic/Icon@2.5.0
                            Properties:
                              Color: =ColorValue("#3280AB")
                              Fill: =RGBA(0,0,0,0)
                              Height: =17
                              Icon: =Icon.ToolsWrench
                              OnSelect: =Select(btnExistingMaintenanceRequestsWOCFS)
                              PaddingRight: =5
                              PressedFill: =gblAppStyles.Pills.PressedFill
                              Width: =29
                              X: =7
                              Y: =11
            - conCreateWorkOrderForm:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  AlignInContainer: =AlignInContainer.SetByContainer
                  LayoutAlignItems: =LayoutAlignItems.Stretch
                  LayoutDirection: =LayoutDirection.Vertical
                  LayoutGap: =16
                  LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                  LayoutOverflowY: =LayoutOverflow.Scroll
                  PaddingBottom: =16
                  PaddingLeft: =gblAppStyles.Padding.Left
                  PaddingRight: =gblAppStyles.Padding.Right
                  PaddingTop: =16
                  Width: =Parent.Width
                Children:
                  - lblCreateWorkOrderIntro:
                      Control: Label@2.5.1
                      Properties:
                        Color: =gblAppColors.PrimaryText
                        Font: =gblAppStyles.CommonFont
                        Height: =25
                        PaddingBottom: =0
                        PaddingTop: =0
                        Size: =gblAppStyles.FontSize_Large
                        Text: =T.WOCreationInstructionLabel
                        Width: =Parent.Width
                  - conNewWorkOrderServiceLevel:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        Fill: =gblAppColors.Neutral
                        FillPortions: =0
                        Height: =72
                        LayoutMinHeight: =60
                        PaddingBottom: =(conNewWorkOrderServiceLevel.Height - lblNewWorkOrderServiceLevel.Height - drpNewWorkOrderServiceLevel.Height)/2
                        PaddingTop: =(conNewWorkOrderServiceLevel.Height - lblNewWorkOrderServiceLevel.Height - drpNewWorkOrderServiceLevel.Height)/2
                        Width: =Parent.Width - Parent.PaddingLeft*2
                      Children:
                        - shpNewWorkOrderServiceLevelBottomBorder:
                            Control: Rectangle@2.3.0
                            Properties:
                              Fill: =gblAppColors.AccentLink
                              Height: =2
                              Width: =Parent.Width
                              Y: =Parent.Height - Self.Height
                        - drpNewWorkOrderServiceLevel:
                            Control: Classic/DropDown@2.3.1
                            Properties:
                              AccessibleLabel: =T.WOServiceLevelAccessibleLabel
                              BorderThickness: =0
                              ChevronBackground: =RGBA(255, 255, 255, 1)
                              ChevronFill: =gblAppColors.Accent
                              Color: =gblAppColors.Accent
                              Default: =locDefaultServiceLevel
                              FocusedBorderColor: =gblAppStyles.FocusBorderColor
                              FocusedBorderThickness: =gblAppStyles.FocusBorderThickness
                              Font: =gblAppStyles.CommonFont
                              Height: =32
                              Items: =Filter('Work Order Service Levels', mserp_dataareaid = locAsset.mserp_dataareaid)
                              Items.Value: =mserp_formattedservicelevelname
                              PaddingLeft: =8
                              PressedColor: =Self.Color
                              PressedFill: =gblAppColors.Neutral
                              SelectionFill: =gblAppColors.Accent
                              Size: =gblAppStyles.FontSize_Large
                              Width: =Parent.Width-8
                              Y: =27
                        - lblNewWorkOrderServiceLevel:
                            Control: Label@2.5.1
                            Properties:
                              Color: =gblAppStyles.Label.FontColor
                              Font: =gblAppStyles.Label.Font
                              Height: =27
                              PaddingLeft: =8
                              Size: =gblAppStyles.Label.FontSize
                              Text: =T.ServiceLevelLabel
                              Width: =225
                  - conNewWorkOrderType:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        Fill: =gblAppColors.Neutral
                        FillPortions: =0
                        Height: =72
                        LayoutMinHeight: =60
                        PaddingLeft: =8
                        PaddingRight: =10
                        Width: =Parent.Width - Parent.PaddingLeft*2
                      Children:
                        - shpNewWorkOrderTypeBottomBorder:
                            Control: Rectangle@2.3.0
                            Properties:
                              Fill: =gblAppColors.AccentLink
                              Height: =2
                              Width: =Parent.Width
                              Y: =Parent.Height - Self.Height
                        - drpNewWorkOrderType:
                            Control: Classic/DropDown@2.3.1
                            Properties:
                              AccessibleLabel: =T.WOTypeAccessibleLabel
                              BorderThickness: =0
                              ChevronBackground: =RGBA(255, 255, 255, 1)
                              ChevronFill: =gblAppColors.Accent
                              Color: =gblAppColors.Accent
                              Default: =locDefaultWorkOrderType
                              FocusedBorderColor: =gblAppStyles.FocusBorderColor
                              FocusedBorderThickness: =gblAppStyles.FocusBorderThickness
                              Font: =gblAppStyles.CommonFont
                              Height: =31
                              Items: |-
                                =Filter(
                                    'Asset management work order types (mserp)',
                                    mserp_dataareaid = locAsset.mserp_dataareaid
                                )
                              Items.Value: =mserp_workordertypeid
                              PaddingLeft: =8
                              PressedColor: =Self.Color
                              PressedFill: =gblAppColors.Neutral
                              SelectionFill: =gblAppColors.Accent
                              Size: =gblAppStyles.FontSize_Large
                              Width: =Parent.Width-8
                              Y: =27
                        - lblNewWorkOrderType:
                            Control: Label@2.5.1
                            Properties:
                              Color: =gblAppStyles.Label.FontColor
                              Font: =gblAppStyles.Label.Font
                              Height: =27
                              PaddingLeft: =8
                              Size: =gblAppStyles.Label.FontSize
                              Text: =T.WorkOrderTypeLabel
                              Width: =Parent.Width
                  - imgAddAttachmentToNewWorkOrder:
                      Control: Image@2.2.3
                      Group: grpAddAttachmentToNewWorkOrder
                      Properties:
                        ApplyEXIFOrientation: =false
                        Height: =Self.Width
                        Image: =If(!IsBlank(btnAddAttachmentToNewWorkOrder.Media), btnAddAttachmentToNewWorkOrder.Media)
                        LayoutMinHeight: =50
                        Visible: =false
                        Width: =Min(300,Parent.Width -16*2)
                        X: =btnAddAttachmentToNewWorkOrder.X
                        Y: =btnAddAttachmentToNewWorkOrder.Y
                  - conNewWorkOrderJobType:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        Fill: =gblAppColors.Neutral
                        FillPortions: =0
                        Height: =72
                        LayoutMinHeight: =60
                        PaddingLeft: =8
                        PaddingRight: =10
                        Width: =Parent.Width - Parent.PaddingLeft*2
                      Children:
                        - shpNewWorkOrderJobTypeBottomBorder:
                            Control: Rectangle@2.3.0
                            Properties:
                              Fill: =gblAppColors.AccentLink
                              Height: =2
                              Width: =Parent.Width
                              Y: =Parent.Height - Self.Height
                        - drpNewWorkOrderJobType:
                            Control: Classic/DropDown@2.3.1
                            Properties:
                              AccessibleLabel: =T.WOJobTypeAccessibleLabel
                              BorderThickness: =0
                              ChevronBackground: =RGBA(255, 255, 255, 1)
                              ChevronFill: =gblAppColors.Accent
                              Color: =gblAppColors.Accent
                              Default: =locDefaultWorkOrderType
                              FocusedBorderColor: =gblAppStyles.FocusBorderColor
                              FocusedBorderThickness: =gblAppStyles.FocusBorderThickness
                              Font: =gblAppStyles.CommonFont
                              Height: =31
                              Items: |-
                                =Filter(
                                    'Asset management maintenance job types (mserp)',
                                    mserp_dataareaid = locAsset.mserp_dataareaid
                                )
                              Items.Value: =mserp_name
                              PaddingLeft: =8
                              PressedColor: =Self.Color
                              PressedFill: =gblAppColors.Neutral
                              SelectionFill: =gblAppColors.Accent
                              Size: =gblAppStyles.FontSize_Large
                              Width: =Parent.Width-8
                              Y: =27
                        - lblNewWorkOrderJobType:
                            Control: Label@2.5.1
                            Properties:
                              Color: =gblAppStyles.Label.FontColor
                              Font: =gblAppStyles.Label.Font
                              Height: =27
                              PaddingLeft: =8
                              Size: =gblAppStyles.Label.FontSize
                              Text: =T.WOJobType
                              Width: =Parent.Width
                  - conNewWorkOrderJobTypeVariant:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        Fill: =gblAppColors.Neutral
                        FillPortions: =0
                        Height: =72
                        LayoutMinHeight: =60
                        PaddingLeft: =8
                        PaddingRight: =10
                        Visible: =Not IsBlank(drpNewWorkOrderJobTypeVariant.Selected)
                        Width: =Parent.Width - Parent.PaddingLeft*2
                      Children:
                        - shpNewWorkOrderJobTypeVariantBottomBorder:
                            Control: Rectangle@2.3.0
                            Properties:
                              Fill: =gblAppColors.AccentLink
                              Height: =2
                              Width: =Parent.Width
                              Y: =Parent.Height - Self.Height
                        - drpNewWorkOrderJobTypeVariant:
                            Control: Classic/DropDown@2.3.1
                            Properties:
                              AccessibleLabel: =T.WOJobTypeVariantAccessibleLabel
                              BorderThickness: =0
                              ChevronBackground: =RGBA(255, 255, 255, 1)
                              ChevronFill: =gblAppColors.Accent
                              Color: =gblAppColors.Accent
                              Default: =locDefaultWorkOrderType
                              FocusedBorderColor: =gblAppStyles.FocusBorderColor
                              FocusedBorderThickness: =gblAppStyles.FocusBorderThickness
                              Font: =gblAppStyles.CommonFont
                              Height: =31
                              Items: |-
                                =Filter(
                                    'Asset management maintenance job type variants (mserp)',
                                    mserp_dataareaid = locAsset.mserp_dataareaid,
                                    mserp_jobtypeid = drpNewWorkOrderJobType.Selected.mserp_jobtypeid
                                )
                              Items.Value: =mserp_jobvariantid
                              PaddingLeft: =8
                              PressedColor: =Self.Color
                              PressedFill: =gblAppColors.Neutral
                              SelectionFill: =gblAppColors.Accent
                              Size: =gblAppStyles.FontSize_Large
                              Width: =Parent.Width-8
                              Y: =27
                        - lblNewWorkOrderJobTypeVariant:
                            Control: Label@2.5.1
                            Properties:
                              Color: =gblAppStyles.Label.FontColor
                              Font: =gblAppStyles.Label.Font
                              Height: =27
                              PaddingLeft: =8
                              Size: =gblAppStyles.Label.FontSize
                              Text: =T.WOJobTypeVariant
                              Width: =Parent.Width
                  - tglNewWorkOrderScheduleImmediately:
                      Control: Classic/Toggle@2.1.0
                      Properties:
                        AccessibleLabel: =If(Self.Value, T.WOAutoScheduleOffAccessibleLabel, T.WOAutoScheduleOnAccessibleLabel)
                        FalseText: =T.WOAutoScheduleOff
                        Font: =gblAppStyles.CommonFont
                        Size: =gblAppStyles.FontSize_Large
                        TextPosition: =TextPosition.Left
                        TrueText: =T.WOAutoScheduleOn
                  - galNewWorkOrderAttachments:
                      Control: Gallery@2.15.0
                      Variant: BrowseLayout_Horizontal_TwoTextOneImageVariant_ver4.0
                      Properties:
                        AccessibleLabel: =T.WOAttachmentsAccessibleLabel
                        AlignInContainer: =AlignInContainer.SetByContainer
                        DelayItemLoading: =false
                        Height: =260
                        Items: =locWOAttachments
                        LayoutMinHeight: =260
                        LayoutMinWidth: =300
                        LoadingSpinner: =LoadingSpinner.None
                        TemplateSize: =Min(440, Self.Height - 60)
                        Visible: =Not IsEmpty(locWOAttachments)
                      Children:
                        - imgAttachmentWOCFS:
                            Control: Image@2.2.3
                            Properties:
                              ApplyEXIFOrientation: =false
                              Height: =imgAttachmentWOCFS.Width
                              Image: =ThisItem.Value
                              ImagePosition: =ImagePosition.Stretch
                              OnSelect: =Select(Parent)
                              Width: =Parent.TemplateWidth - 16
                              Y: =1
                        - imgRemoveAttachmentWOCFS:
                            Control: Image@2.2.3
                            Properties:
                              AccessibleLabel: =T.RemoveItemIconAccessibleLabel
                              Height: =1
                              Image: =removeImage
                              OnSelect: =Remove(locWOAttachments,ThisItem)
                              PressedFill: =ColorFade(Self.Fill, -30%)
                              Width: =1
                  - btnAddAttachmentToNewWorkOrder:
                      Control: AddMedia@2.2.1
                      Group: grpAddAttachmentToNewWorkOrder
                      Properties:
                        AccessibleLabel: =T.WOAddImageAccessibleLabel
                        BorderColor: =gblAppColors.Primary
                        ChangePictureText: =T.WOAddImageButtonLabel
                        Color: =gblAppColors.Primary
                        Fill: =gblAppColors.Background
                        FocusedBorderColor: =gblAppStyles.FocusBorderColor
                        FocusedBorderThickness: =gblAppStyles.FocusBorderThickness
                        Font: =gblAppStyles.CommonFont
                        Height: =gblAppStyles.Button.Height
                        LayoutMinHeight: =50
                        LayoutMinWidth: =100
                        OnSelect: |-
                          =UpdateContext( {locImageData: JSON( imgAddAttachmentToNewWorkOrder.Image,JSONFormat.IncludeBinaryData )});
                          UpdateContext( {locImageBase64: Mid(locImageData, Find(",", locImageData)+1, Len(locImageData)-Find(",", locImageData)-1)});
                          UpdateContext( {locFileExtension: Mid(locImageData, Find("/", locImageData)+1, Find(";base64,", locImageData) - Find("/", locImageData)-1)});

                          If(
                              Len(locImageBase64) >= DataSourceInfo(
                                  'Asset maintenance work order line attachment entity (mserp)',
                                  DataSourceInfo.MaxLength,
                                  Bitmap
                              ),
                              Notify(T.Error_PhotoTooLargeToAttach, NotificationType.Warning),
                              Collect(
                                  locWOAttachments,
                                  {
                                      Value: btnAddAttachmentToNewWorkOrder.Media,
                                      ImageData: locImageData,
                                      ImageBase64: locImageBase64,
                                      FileExtension: locFileExtension,
                                      FileName: GUID() & "." & locFileExtension
                                  }
                              )
                          )
                        Padding: =10
                        Size: =gblAppStyles.Button.FontSize
                        Text: =T.WOAddImageButtonLabel
                        Width: =Min(300,Parent.Width -16*2)
                        X: =40
                        Y: =40
      - btnCreateWOSubmit:
          Control: Classic/Button@2.2.0
          Properties:
            BorderThickness: =0
            Color: =gblAppStyles.Button.FontColor
            Fill: =gblAppStyles.Button.Fill
            FocusedBorderColor: =gblAppStyles.FocusBorderColor
            FocusedBorderThickness: =gblAppStyles.FocusBorderThickness
            Font: =gblAppStyles.CommonFont
            FontWeight: =gblAppStyles.Button.FontWeight
            Height: =gblAppStyles.Button.Height
            OnSelect: |
              =// 1. Create work order
              // 2. Create work order job line on that work order
              // 3. Create any attachments and attach them to the job line
              With(
                  {
                      locCreatedWorkOrder: Patch(
                          'Asset management work orders V2 (mserp)',
                          Defaults('Asset management work orders V2 (mserp)'),
                          {
                              Description: cmpNewWorkOrderDescription.Text,
                              'Service level': drpNewWorkOrderServiceLevel.Selected.'Service level',
                              'Work order type': drpNewWorkOrderType.Selected.'Work order type',
                              'Company Code': locAsset.'Company Code',
                              'Customer account':locAsset.'Customer account',
                              'Expected start': DateAdd( // UserTime => UTC
                                  Now(),
                                  TimeZoneOffset(),
                                  TimeUnit.Minutes
                              )
                          }
                      )
                  },
                  IfError(
                      locCreatedWorkOrder,
                      // on error:
                      With(
                          {
                              locFnOErrorMessage: Match(
                                  FirstError.Details.HttpResponse,
                                  "\""code"":""(?<code>[^""]*)"",""message"":""(?<message>[^""]*)"
                              ).message
                          },
                          Notify(
                              FirstError.Message,
                              NotificationType.Error
                          );
                          Notify(
                              locFnOErrorMessage,
                              NotificationType.Error
                          );
                          Trace(
                              "Failed creating work order",
                              TraceSeverity.Error,
                              {
                                  FnOError: locFnOErrorMessage,
                                  ErrorMessage: FirstError.Message
                              }
                          );
                      ),
                      // else:
                      With(
                          {
                              locCreatedWorkOrderJobLine: Patch(
                                  'Asset management work order jobs V2 (mserp)',
                                  Defaults('Asset management work order jobs V2 (mserp)'),
                                  {
                                      'Work order': locCreatedWorkOrder.'Work order',
                                      'Line number': 1,
                                      'Company Code': locCreatedWorkOrder.'Company Code',
                                      Asset: locAsset.'Asset (mserp_maintenanceassetid)',
                                      Description: cmpNewWorkOrderDescription.Text,
                                      'Internal note': cmpNewWorkOrderNotes.Text,
                                      'Maintenance job type': drpNewWorkOrderJobType.Selected.'Maintenance job type',
                                      'Maintenance job type variant': drpNewWorkOrderJobTypeVariant.Selected.'Maintenance job type variant',
                                      'Schedule work order job': If(
                                          tglNewWorkOrderScheduleImmediately.Value,
                                          'NoYes (mserp)'.Yes,
                                          'NoYes (mserp)'.No
                                      )
                                  }
                              )
                          },
                          IfError(
                              locCreatedWorkOrderJobLine,
                              // on error:
                              With(
                                  {
                                      locFnOErrorMessage: Match(
                                          FirstError.Details.HttpResponse,
                                          "\""code"":""(?<code>[^""]*)"",""message"":""(?<message>[^""]*)"
                                      ).message
                                  },
                                  Notify(
                                      FirstError.Message,
                                      NotificationType.Error
                                  );
                                  Notify(
                                      locFnOErrorMessage,
                                      NotificationType.Error
                                  );
                                  Trace(
                                      "Failed creating work order job line",
                                      TraceSeverity.Error,
                                      {
                                          FnOError: locFnOErrorMessage,
                                          ErrorMessage: FirstError.Message
                                      }
                                  );
                              ),
                              // else:
                              With(
                                  {
                                      locDocuType: LookUp(
                                          ShowColumns(
                                              Filter(
                                                  'Document types (mserp)',
                                                  'Company Code' = locCreatedWorkOrder.'Company Code'
                                              ),
                                              ActionClassName,
                                              'Company Code',
                                              Type
                                          ),
                                          mserp_actionclassname = "DocuActionArchive"
                                      ),
                                      locImageBase64: Mid(
                                          locImageData,
                                          Find(
                                              ",",
                                              locImageData
                                          ) + 1,
                                          Len(locImageData) - Find(
                                              ",",
                                              locImageData
                                          ) - 1
                                      ),
                                      locFileExtension: Mid(
                                          locImageData,
                                          Find(
                                              "/",
                                              locImageData
                                          ) + 1,
                                          Find(
                                              ";base64,",
                                              locImageData
                                          ) - Find(
                                              "/",
                                              locImageData
                                          ) - 1
                                      )
                                  },
                                  If(
                                      IsBlankOrError(locDocuType),
                                      Notify(T.Error_AttachmentCreationFailureFromMissingDocumentTypeConfiguration);
                                      Trace(
                                          "Unable to create attachments as document type configuration is missing",
                                          TraceSeverity.Error,
                                          {LocDocuType: locDocuType}
                                      ),
                                      ForAll(
                                          locWOAttachments As attachment,
                                          Patch(
                                              'Asset maintenance work order line attachment entity (mserp)',
                                              Defaults('Asset maintenance work order line attachment entity (mserp)'),
                                              {
                                                  'Company Code': locCreatedWorkOrder.'Company Code',
                                                  'Work order': locCreatedWorkOrder.'Work order',
                                                  'Line number': 1,
                                                  DocumentAttachmentTypeLegalEntityId: locDocuType.mserp_dataareaid,
                                                  Type: locDocuType.mserp_id,
                                                  Bitmap: attachment.ImageBase64,
                                                  'Original file name': attachment.FileName,
                                                  Description: attachment.FileName
                                              }
                                          )
                                      );
                                      Clear(locWOAttachments);
                                      Reset(cmpNewWorkOrderDescription);
                                      Reset(cmpNewWorkOrderNotes);
                                      Reset(drpNewWorkOrderServiceLevel);
                                      Reset(drpNewWorkOrderType);
                                      Reset(drpNewWorkOrderJobType);
                                      Reset(drpNewWorkOrderJobTypeVariant);
                                      Reset(tglNewWorkOrderScheduleImmediately);
                                      Navigate(
                                          'Creation Success Screen',
                                          ScreenTransition.None,
                                          {
                                              locHeaderText: lblCreateWOHeader.Text,
                                              locCreatedId: locCreatedWorkOrder.'Work order',
                                              locCreatedType: C.Creation.CreateWorkOrder
                                          }
                                      );
                                  )
                              )
                          )
                      )
                  )
              );
            Size: =gblAppStyles.Button.FontSize
            Text: =T.SubmitButtonLabel
            Width: =Min(300,Parent.Width -16*2)
            X: =(Parent.Width / 2) - (Self.Width/2)
            Y: =conVerticalCreateWorkOrder.Height
