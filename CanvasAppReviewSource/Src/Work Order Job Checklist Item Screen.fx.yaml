"'Work Order Job Checklist Item Screen' As screen":
    Fill: =gblAppColors.Background
    OnHidden: |
        =With(
            {
                locSelectedVariableValue: drpChecklistVariableValue.SelectedText.Value,
                locSelectedVariableCheckStatus: drpChecklistVariableValue.SelectedText.Result,
                locMeasurementCounterValue: Value(txtChecklistMeasurementCounterValue.Text)
            },
            If(
                ChecklistItem.'Note from maintenance worker' <> lblChecklistItemRemark.Text || ChecklistItem.'Variable value' <> locSelectedVariableValue || ChecklistItem.'Counter value' <> locMeasurementCounterValue,
                Patch(
                    'Asset management work order job maintenance checklist (mserp)',
                    ChecklistItem,
                    {
                        Checked: varIsChecklistItemChecked,
                        'Note from maintenance worker': lblChecklistItemRemark.Text,
                        'Variable value': locSelectedVariableValue,
                        'Counter value': locMeasurementCounterValue,
                        Result: Switch(
                            ChecklistItem.Type,
                            'Type (mserp)'.Variable,
                            If(locSelectedVariableCheckStatus <> Blank(), locSelectedVariableCheckStatus, 'Result (mserp)'.None),
                            'Type (mserp)'.Measurement,
                            If(
                            // Set Result to None if min and max threshold are 0
                                ChecklistItem.'Counter minimum value' = 0 && ChecklistItem.'Counter maximum value' = 0,
                                'Result (mserp)'.None,
                                If(
                                    ChecklistItem.'Counter minimum value' <= locMeasurementCounterValue && locMeasurementCounterValue <= ChecklistItem.'Counter maximum value',
                                    'Result (mserp)'.Pass,
                                    'Result (mserp)'.Fail
                                )
                            ),
                            'Result (mserp)'.None
                        )
                    }
                )
            );
        );
    OnVisible: |-
        =UpdateContext({ varIsChecklistItemChecked: ChecklistItem.Checked });
        Reset(lblChecklistItemRemark);
        
        // should go last
        Set(
            gblPreviousScreen,
            Self
        );

    conChecklistWrapper As groupContainer.verticalAutoLayoutContainer:
        Height: =Parent.Height - Self.Y
        LayoutAlignItems: =LayoutAlignItems.Stretch
        LayoutDirection: =LayoutDirection.Vertical
        LayoutMode: =LayoutMode.Auto
        LayoutOverflowY: =LayoutOverflow.Scroll
        Width: =Parent.Width
        Y: =cmpHeaderWOJCIS.Height
        ZIndex: =3

        conChecklistAndCardBackground As groupContainer:
            FillPortions: =0
            Height: =htmCardBackgroundHeaderWOJCIS.Height + htmCardBackgroundHeaderWOJCIS.Y
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            Width: =1366
            ZIndex: =1

            htmCardBackgroundHeaderWOJCIS As htmlViewer:
                DisabledBorderColor: =RGBA(56, 56, 56, 1)
                Height: =conChecklistDetails.Height
                HtmlText: |-
                    ="<div style=""padding: 5px 8px 10px;height:100%;position:absolute;width:100%;box-sizing:border-box;""><div style=""background-color:#fff;box-shadow:0px 2px 4px rgba(0,0,0,0.14),0px 0px 2px rgba(0,0,0, 0.12);border-radius:15px;height:100%;width:100%;""></div></div>"
                OnSelect: =
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Width: =Parent.Width
                Y: =12
                ZIndex: =1

            conChecklistDetails As groupContainer.verticalAutoLayoutContainer:
                Height: |-
                    =lblChecklistName.Height
                        + lblChecklistInstructionLabel.Height
                        + lblChecklistInstruction.Height
                        + lblChecklistItemRemark.Height
                        + btnMarkAsChecked.Height
                        + If(ChecklistItem.mserp_type = 'Type (mserp)'.Variable, conChecklistVariableType.Height)
                        + If(ChecklistItem.mserp_type = 'Type (mserp)'.Measurement, conChecklistMeasurementType.Height)
                        + Self.LayoutGap * (5 + If(ChecklistItem.mserp_type <> 'Type (mserp)'.Text, 1))
                        + Self.PaddingTop
                        + Self.PaddingBottom
                LayoutAlignItems: =LayoutAlignItems.Stretch
                LayoutDirection: =LayoutDirection.Vertical
                LayoutGap: =5
                LayoutMode: =LayoutMode.Auto
                LayoutOverflowY: =LayoutOverflow.Scroll
                PaddingBottom: =20
                PaddingLeft: =20
                PaddingRight: =20
                PaddingTop: =24
                Width: =Parent.Width
                Y: =8
                ZIndex: =2

                lblChecklistName As label:
                    AutoHeight: =true
                    Font: =Font.'Segoe UI'
                    Size: =gblAppStyles.FontSize_Large
                    Text: =ChecklistItem.mserp_name
                    Width: =Parent.Width - Self.X - 16
                    X: =16
                    Y: =16
                    ZIndex: =1

                lblChecklistInstructionLabel As label:
                    AutoHeight: =true
                    Color: =RGBA(92, 92, 92, 1)
                    Font: =Font.'Segoe UI'
                    Height: =70
                    Size: =gblAppStyles.FontSize_Small
                    Text: =T.ChecklistInstructionHeaderLabel
                    VerticalAlign: =VerticalAlign.Bottom
                    Width: =Parent.Width - Self.X - 16
                    X: =16
                    Y: =16
                    ZIndex: =2

                lblChecklistInstruction As label:
                    AutoHeight: =true
                    Color: =RGBA(33, 33, 33, 1)
                    Font: =Font.'Segoe UI'
                    Height: =70
                    Size: =gblAppStyles.FontSize_Medium
                    Text: =Coalesce(ChecklistItem.mserp_instructions, C.EmDash)
                    VerticalAlign: =VerticalAlign.Top
                    Width: =Parent.Width - Self.X - 16
                    X: =16
                    Y: =16
                    ZIndex: =3

                conChecklistVariableType As groupContainer.verticalAutoLayoutContainer:
                    FillPortions: =0
                    Height: =lblChecklistVariableType.Height + drpChecklistVariableValue.Height + drpChecklistVariableValue.BorderThickness * 4
                    LayoutAlignItems: =LayoutAlignItems.Stretch
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    PaddingBottom: =2
                    PaddingLeft: =2
                    PaddingRight: =2
                    PaddingTop: =2
                    Visible: =ChecklistItem.mserp_type = 'Type (mserp)'.Variable
                    Width: =200
                    ZIndex: =4

                    lblChecklistVariableType As label:
                        AutoHeight: =true
                        Color: =RGBA(92, 92, 92, 1)
                        Font: =Font.'Segoe UI'
                        Size: =gblAppStyles.FontSize_Small
                        Text: =ChecklistItem.'Asset management maintenance checklist variable'.Name
                        ZIndex: =1

                    drpChecklistVariableValue As dropdown:
                        AccessibleLabel: =T.CheckListVariableAccessibleLabel
                        AlignInContainer: =AlignInContainer.Stretch
                        AllowEmptySelection: =true
                        BorderColor: =RGBA(31, 108, 249, 1)
                        BorderThickness: =1
                        ChevronBackground: =RGBA(0, 0, 0, 0)
                        ChevronFill: =RGBA(41, 40, 39, 1)
                        ChevronHoverBackground: =RGBA(0, 0, 0, 0)
                        ChevronHoverFill: =Self.ChevronFill
                        Color: =RGBA(41, 40, 39, 1)
                        Default: =$"{ChecklistItem.mserp_variablevalueid} ({ChecklistItem.mserp_linestatus})"
                        Font: =Font.'Segoe UI'
                        Items: |-
                            =AddColumns(
                                SortByColumns(
                                    Filter(
                                        'Asset management maintenance checklist variable value (mserp)',
                                        mserp_dataareaid = ChecklistItem.mserp_dataareaid && mserp_checklistvariableid = ChecklistItem.mserp_checklistvariableid
                                    ),
                                    "mserp_linenumber"
                                ),
                                DropdownText,
                                $"{mserp_value} ({mserp_checkstatus})"
                            )
                        LayoutMinWidth: =180
                        PressedColor: =Self.Color
                        PressedFill: =Self.Fill
                        Size: =gblAppStyles.FontSize_Medium
                        Width: =Parent.Width - Parent.PaddingLeft - Parent.PaddingRight
                        ZIndex: =2

                conChecklistMeasurementType As groupContainer.verticalAutoLayoutContainer:
                    FillPortions: =0
                    Height: =lblChecklistMeasurementCounterName.Height + conChecklistMeasurementInputAndUnit.Height + lblMeasurementMinMax.Height + lblMeasurementResult.Height
                    LayoutAlignItems: =LayoutAlignItems.Stretch
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    PaddingBottom: =2
                    PaddingLeft: =2
                    PaddingRight: =2
                    PaddingTop: =2
                    Visible: =ChecklistItem.mserp_type = 'Type (mserp)'.Measurement
                    Width: =200
                    ZIndex: =5

                    lblChecklistMeasurementCounterName As label:
                        AutoHeight: =true
                        Color: =RGBA(92, 92, 92, 1)
                        Font: =Font.'Segoe UI'
                        Size: =10
                        Text: |-
                            =// TODO: can we do this smarter? Seems silly to do a OData lookup just for this value
                            LookUp(
                                'Asset management asset counters (mserp)',
                                mserp_counterid = ChecklistItem.mserp_checkedmaintenanceassetcounterid && mserp_dataareaid = ChecklistItem.mserp_dataareaid
                            ).Name
                        ZIndex: =1

                    conChecklistMeasurementInputAndUnit As groupContainer.horizontalAutoLayoutContainer:
                        FillPortions: =0
                        Height: =txtChecklistMeasurementCounterValue.Height + txtChecklistMeasurementCounterValue.BorderThickness
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =3

                        shpChecklistMeasurementInputFieldBorderFix As rectangle:
                            AlignInContainer: =AlignInContainer.Stretch
                            Fill: =RGBA(0, 0, 0, 0)
                            LayoutMinHeight: =40
                            Width: =1
                            ZIndex: =1

                        txtChecklistMeasurementCounterValue As text:
                            AccessibleLabel: =T.CheckListMeasurementCounterValue
                            BorderColor: =RGBA(31, 108, 249, 1)
                            BorderThickness: =1
                            Clear: =true
                            Color: =RGBA(41, 40, 39, 1)
                            Default: =ChecklistItem.mserp_measurevalue
                            Format: =TextFormat.Number
                            RadiusBottomLeft: =8
                            RadiusBottomRight: =8
                            RadiusTopLeft: =8
                            RadiusTopRight: =8
                            Width: =150
                            ZIndex: =2

                        lblChecklistMeasurementCounterUnit As label:
                            AutoHeight: =true
                            Color: =RGBA(92, 92, 92, 1)
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Semibold
                            LayoutMinWidth: =75
                            Size: =12
                            Text: =ChecklistItem.mserp_measureunitid
                            Width: =75
                            ZIndex: =3

                    lblMeasurementMinMax As label:
                        AlignInContainer: =AlignInContainer.Stretch
                        AutoHeight: =true
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Semibold
                        Size: =10.5
                        Text: =Substitute(Substitute(T.ChecklistMeasurementMinMaxLabel, "{MeasurementMinimum}", ChecklistItem.mserp_measureminvalue), "{MeasurementMaximum}", ChecklistItem.mserp_measuremaxvalue)
                        ZIndex: =4

                    lblMeasurementResult As label:
                        AlignInContainer: =AlignInContainer.Stretch
                        AutoHeight: =true
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Semibold
                        Size: =10.5
                        Text: =Substitute(T.ChecklistMeasurementResultLabel, "{MeasurementResult}", ChecklistItem.mserp_linestatus)
                        ZIndex: =5

                lblChecklistItemRemark As text:
                    AccessibleLabel: =T.CheckListItemRemarkAccessibleLabel
                    BorderColor: =RGBA(31, 108, 249, 1)
                    BorderThickness: =1
                    Default: =ChecklistItem.mserp_notes
                    Font: =Font.'Segoe UI'
                    Height: =108
                    HintText: =T.ChecklistYourNotesPlaceholderLabel
                    LayoutMinWidth: =250
                    Mode: =TextMode.MultiLine
                    RadiusBottomLeft: =8
                    RadiusBottomRight: =8
                    RadiusTopLeft: =8
                    RadiusTopRight: =8
                    Size: =gblAppStyles.FontSize_Large
                    ZIndex: =6

                btnMarkAsChecked As button:
                    Fill: =gblAppColors.Accent
                    FocusedBorderColor: =gblAppStyles.FocusBorderColor
                    FocusedBorderThickness: =gblAppStyles.FocusBorderThickness
                    OnSelect: |
                        =UpdateContext(
                            {
                                varIsChecklistItemChecked: If(
                                    varIsChecklistItemChecked = 'NoYes (mserp)'.Yes,
                                    'NoYes (mserp)'.No,
                                    'NoYes (mserp)'.Yes
                                )
                            }
                        );
                        Back();
                    Size: =gblAppStyles.Button.FontSize
                    Text: =If(ChecklistItem.mserp_checked = 'NoYes (mserp)'.No, T.ChecklistMarkAsCheckedButtonLabel, T.ChecklistMarkAsUnCheckedButtonLabel)
                    ZIndex: =7

    cmpHeaderWOJCIS As SubScreenHeader:
        BackButtonAccessibleLabel: =T.BackButtonAccessibleLabel
        Title: =If(Len(ChecklistItem.mserp_name) > 30, $"{TrimEnds(Left(ChecklistItem.mserp_name, 30))}...", ChecklistItem.mserp_name)
        ZIndex: =4

